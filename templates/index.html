<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PCEP Quiz POC</title>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 720px;
        margin: 40px auto;
        padding: 0 16px;
      }
      pre {
        background: #f5f5f5;
        padding: 12px;
        overflow: auto;
      }
      .options {
        margin: 16px 0;
      }
      .result {
        margin-top: 16px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>PCEP Quiz</h1>
    <p>
      Score:
      <span id="stats-total">0</span> answered,
      <span id="stats-correct">0</span> correct
      (<span id="stats-percent">0%</span>)
    </p>

    <div id="question-card">
      {% include "question.html" %}
    </div>

    <script>
      let totalAnswered = 0;
      let correctAnswered = 0;

      function updateStats() {
        const percent = totalAnswered
          ? Math.round((correctAnswered / totalAnswered) * 100)
          : 0;
        document.getElementById("stats-total").textContent = totalAnswered;
        document.getElementById("stats-correct").textContent = correctAnswered;
        document.getElementById("stats-percent").textContent = `${percent}%`;
      }

      document.body.addEventListener("htmx:afterSwap", (event) => {
        if (!event.detail.target || event.detail.target.id !== "result") {
          return;
        }

        const marker = document.getElementById("stats-update");
        if (!marker) {
          return;
        }

        totalAnswered += 1;
        if (marker.dataset.correct === "1") {
          correctAnswered += 1;
        }

        updateStats();
        marker.remove();
      });
    </script>
  </body>
</html>
