<p>{{ question.question }}</p>

{% if question.code %}
  <pre>{{ question.code }}</pre>
{% endif %}

<form
  hx-post="/check"
  hx-target="#result"
  hx-swap="innerHTML"
  hx-on="change: if (event.target.name === 'selected') { const btn = this.querySelector('#action-button'); if (btn && btn.dataset.state === 'check') { const anyChecked = this.querySelectorAll('input[name=selected]:checked').length > 0; btn.disabled = !anyChecked; } }"
  autocomplete="off"
>
  <input type="hidden" name="question_index" value="{{ question_index }}" />

  <div class="options">
    {% set input_type = "checkbox" if question.answers | length > 1 else "radio" %}
    {% for key, label in question.options.items() %}
      <div>
        <label>
          <input
            type="{{ input_type }}"
            name="selected"
            value="{{ key }}"
            {% if answered and key in answered.selected %}checked{% endif %}
            {% if answered %}disabled{% elif input_type == "radio" %}required{% endif %}
          />
          {{ label }}
        </label>
      </div>
    {% endfor %}
  </div>

  <button
    type="button"
    hx-get="/previous?index={{ question_index }}"
    hx-target="#question-card"
    hx-swap="innerHTML"
    {% if is_first %}disabled{% endif %}
  >
    Previous
  </button>
  {% if answered %}
    <button
      id="action-button"
      type="button"
      hx-get="/next?index={{ question_index }}"
      hx-target="#question-card"
      hx-swap="innerHTML"
      data-state="next"
      {% if is_last %}disabled{% endif %}
    >
      Next
    </button>
  {% else %}
    <button id="action-button" type="submit" disabled data-state="check">
      Check answer
    </button>
  {% endif %}
</form>

<div id="result" class="result">
  {% if answered %}
    {% include "result.html" %}
  {% endif %}
</div>
